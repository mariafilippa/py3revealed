<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>reveal.js</title>

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/night.css" id="theme">
    <link rel="stylesheet" href="css/custom.css">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="lib/css/atom-one-dark-reasonable.css">
    <link rel="stylesheet" href="node_modules/xterm/dist/xterm.css" />
    <script type="module">
      // Import Xterm reqs.
      import * as attach from './node_modules/xterm/dist/addons/attach/attach.js';
      import * as fit from './node_modules/xterm/dist/addons/fit/fit.js';
    </script>

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
  </head>
  <body>
    <div class="reveal">
      <div class="slides">
        <section data-background-image="assets/vs.jpg" data-transition="fade">
            <div class="fragment fade-left" style="position: relative; top: -60px; left: -420px;">
                <img data-src="assets/3.jpg" style="height: 640px;">
                <h1 style="font-size: 124px; writing-mode: vertical-rl; text-orientation: sideways; position: relative; top: -496px; left: 265px;">Python</h1>
            </div>
            <div class="fragment fade-right" style="position: relative; top: -1100px; left: 420px;">
                <img data-src="assets/2.jpg" style="height: 640px;">
                <h1 style="color: #777777; font-size: 124px; position: relative; top: -280px; left: -10px;">Python</h1>
            </div>
        </section>

        <section data-transition="fade" data-background-video="assets/intro.mp4">
            <div class="fragment fade-in-then-out" style="">
                <h1><span style="background-color: #FF69B4; position: relative; top: -260px; left: -100px; font-size: 196px;">Python</span></h1>
            </div>
        </section>

        <section>
          <section>
            <h2>Relative Import vs Absolute Import</h2>
            <img data-src="assets/import_structure.png" style="height: 400px;">
          </section>
          <!-- Terminal slides MUST have a unique data-state="terminal-*" value. -->
          <section data-state="terminal-import2">
            <h5 class="py2-xterm">Python 2 預設為 relative import</h5>
            <!--
              The terminal will be attached to the first child element with data-is-terminal.
              The data-cwd attribute sets a relative or absolute working directory, and is optional.
              Relative paths are created in the 'terms' directory in this package as needed.
            -->
            <div data-is-terminal data-cwd="../example" data-cmd="python entry.py" data-cursor="#FFFF00"></div>
          </section>
          <section data-state="terminal-import3">
            <h5 class="py3-xterm">Python 3 使用 absolute import</h5>
            <div data-is-terminal data-cwd="../example" data-cmd="python3 entry.py" data-cursor="#FF69B4"></div>
          </section>

          <section data-background-image="assets/safe_zone.jpg">
            <div class="fragment fade-left" style="position:relative; top: -150px;">
                <pre><code  class="hljs" data-trim contenteditable>
                    from __future__ import absolute_import
                </code></pre>
            </div>
          </section>
        </section>

        <section>
          <section data-transition="fade" data-background-image="assets/wall_maria.gif">
            <h2><span style="background-color: rgba(131, 3, 3, 0.4);">Unicode vs Str</span></h2>
            <pre><code  class="hljs" data-trim contenteditable style="background-color: rgba(0, 0, 0, 0.8)">
                # python 2
                patterns = (
                    (
                        'storage.googleapis.com/livingbio-storage',
                        'static-gstorage.gliavideo.cn'
                    ),
                )

                if hasattr(response, 'content'):
                    content = response.content

                    for r in patterns:
                        content = content.replace(*r)

                response.content = content
            </code></pre>
          </section>
          <section data-transition="fade">
            <h2>Unicode vs Str</h2>
            <pre><code  class="hljs" data-trim contenteditable>
                # python 3
                patterns = (
                    (
                        b'storage.googleapis.com/livingbio-storage',
                        b'static-gstorage.gliavideo.cn'
                    ),
                )

                if hasattr(response, 'content'):
                    content = response.content

                    for r in patterns:
                        content = content.replace(*r)

                response.content = content
            </code></pre>
          </section>
          <section data-state="terminal-unicode2">
            <h5 class="py2-xterm">Python 2 Str 是 bytes</h5>
            <div data-is-terminal data-cwd="." data-cmd='python_cmd_from __future__ import_cmd__cmd__cmd__cmd__cmd__cmd__cmd_from hashlib import md5_cmd_md5("text")' data-cursor="#FFFF00"></div>
          </section>
          <section data-state="terminal-unicode3">
            <h5 class="py3-xterm">Python 3 Str 是 unicode</h5>
            <div data-is-terminal data-cwd="." data-cmd='python3_cmd__cmd__cmd__cmd_from hashlib import md5_cmd_md5("text")' data-cursor="#FF69B4"></div>
          </section>
        </section>

        <section>
          <section data-transition="fade">
              <h2>__future__</h2>
              <pre><code class="hljs" data-trim contenteditable>
                  from __future__ import absolute_import
                  from __future__ import unicode_literals
              </code></pre>
          </section>
          <section data-transition="fade" data-background-image="assets/rocket.jpg">
              <h2>__future__</h2>
              <pre><code class="hljs" data-trim contenteditable style="background-color: rgba(0, 0, 0, 0.8)">
                  from __future__ import absolute_import
                  from __future__ import unicode_literals
              </code></pre>
          </section>
          <section>
              <pre><code class="hljs" data-trim contenteditable>
                  發現一張沾滿灰塵的捲軸，打開它嗎？ Y/N
              </code></pre>
          </section>
          <section data-background-iframe="https://docs.python.org/3/library/__future__.html" data-state="terminal-future2">
            <div class="fragment" data-is-terminal data-cwd="." data-cmd='python_cmd_from __future__ import_cmd__cmd__cmd__cmd__cmd__cmd__cmd__cmd_e = "இ"_cmd_m = "д"'></div>
          </section>
        </section>

        <section>
          <section>
              <h2>Iterator vs List</h2>
              <pre><code class="hljs" data-trim contenteditable>
                  print(type( range(10) ))
                  print(type( map(lambda x: x, []) ))
                  print(type( filter(lambda x: bool(x), []) ))
                  print(type( zip([], []) ))
              </code></pre>

              <h5>Python 2</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  &lt;type 'list'>
                  &lt;type 'list'>
                  &lt;type 'list'>
                  &lt;type 'list'>
              </code></pre>

              <h5>Python 3</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  &lt;class 'range'>
                  &lt;class 'map'>
                  &lt;class 'filter'>
                  &lt;class 'zip'>
              </code></pre>
          </section>

          <section data-transition="fade" data-state="terminal-cmp2">
              <h2>Comparison in Py2</h2>
              <pre><code class="hljs" data-trim contenteditable>
                  print( -1 > None )
                  print( set.__dict__ <= type(zip) )
              </code></pre>
              <div data-is-terminal data-cwd="." data-cmd='python'></div>
          </section>

          <section data-transition="fade">
              <h2>Comparison in Py2</h2>
              <video data-autoplay style="height: 640px; position: relative; top: -70px;">
                  <source data-src="assets/double_shock.mp4" type="video/mp4"/>
              </video>
              <div class="fragment fade-in" style="font-size: 200px; position: absolute; left: 0px; top: 300px; width: 960px;">
                  <pre><code class="hljs" data-trim contenteditable>
                      Double Shock!
                  </code></pre>
              </div>
          </section>

          <section>
              <h2>Comparison</h2>
              <pre><code class="hljs" data-trim contenteditable>
                  print( -1 > None )
                  print( set.__dict__ <= type(zip) )
              </code></pre>

              <h5>Python 2</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  True
                  True
              </code></pre>

              <h5>Python 3</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  Traceback (most recent call last):
                    File "&lt;stdin>", line 1, in &lt;module>
                  TypeError: '>' not supported between instances of 'int' and 'NoneType'
                  Traceback (most recent call last):
                    File "&lt;stdin>", line 1, in &lt;module>
                  TypeError: '<' not supported between instances of 'dict' and 'type'
              </code></pre>
          </section>

          <section>
              <h2>Exception</h2>
              <pre><code class="hljs" data-trim contenteditable>
                  class YourHand:
                      pass

                  try:
                      raise YourHand
                  except YourHand as heyho:
                      print(heyho)
              </code></pre>

              <h5>Python 2</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  &lt;__main__.YourHand instance at 0x10ffca638>
              </code></pre>

              <h5>Python 3</h5>
              <pre><code class="hljs" data-trim contenteditable>
                Traceback (most recent call last):
                  File "&lt;stdin>", line 2, in  &lt;module>
                TypeError: exceptions must derive from BaseException
              </code></pre>
          </section>

          <section data-background-image="assets/meteor.png">
              <h2 style="color: #f70027;">Exception</h2>
              <pre><code class="hljs" data-trim contenteditable style="background-color: rgba(0, 0, 0, 0.8)">
                  class SuperException(BaseException):
                      pass

                  try:
                      raise SuperException
                  except Exception as err:
                      print(err)
              </code></pre>

              <h5 style="color: #f70027">Python 3</h5>
              <pre><code class="hljs" data-trim contenteditable style="background-color: rgba(0, 0, 0, 0.8)">
                  Traceback (most recent call last):
                    File "&lt;stdin>", line 2, in &lt;module>
                  __main__.SuperException
              </code></pre>
          </section>

          <section>
              <h2>Metaclass</h2>
              <h5>Python 2</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  class C:
                      __metaclass__ = M
                      ...
              </code></pre>

              <h5>Python 3</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  class C(metaclass=M):
                      ...

                  # new-style class
                  class ClassName(object):
                      ....
              </code></pre>
          </section>

          <section>
              <h2>List Comprehension</h2>
              <pre><code class="hljs" data-trim contenteditable>
                  [word for word in "this sentence"]
                  print(word)
              </code></pre>

              <h5>Python 2</h5>
              <pre><code class="hljs" data-trim contenteditable>
                  e
              </code></pre>

              <h5>Python 3</h5>
              <pre><code class="hljs" data-trim contenteditable>
                Traceback (most recent call last):
                  File "&lt;stdin>", line 1, in &lt;module>
                NameError: name 'word' is not defined
              </code></pre>
          </section>

          <section data-background-image="assets/gif.gif"></section>

          <section data-background-iframe="https://docs.python.org/3.0/whatsnew/3.0.html">
              <h2 style="background-color: rgba(0, 0, 0, 0.8);">And much more</h2>
          </section>
        </section>

        <section>
            <section data-transition="fade">
                <h2>Six</h2>
                <pre><code class="hljs" data-trim contenteditable>
                    isinstance('text', six.string_types)

                    class MyClass(six.with_metaclass(Meta, Base)):
                        pass

                    from six.moves.urllib.parse import quote
                </code></pre>
                <h5>Why six?</h5>
                <pre><code class="hljs" data-trim contenteditable style="font-size: 28px;">
                    2 * 3
                </code></pre>
            </section>

            <section data-transition="fade" data-background-image="assets/v.png">
                <h2>Six</h2>
                <pre><code class="hljs" data-trim contenteditable style="background-color: #000000;">
                    isinstance('text', six.string_types)

                    class MyClass(six.with_metaclass(Meta, Base)):
                        pass

                    from six.moves.urllib.parse import quote
                </code></pre>
                <h5>Why six?</h5>
                <pre><code class="hljs" data-trim contenteditable style="background-color: #000000; font-size: 28px;">
                    2 * 3
                </code></pre>
            </section>
        </section>

        <section>
            <section>
                <h2>Porting to Python 3</h2>
                <ul>
                    <li>了解 Py2 與 Py3 差異</li>
                    <li>Good Coverage</li>
                    <li>Futurize</li>
                </ul>
                <img data-src="assets/futurized.png"></img>
            </section>
            <section data-transition="fade" >
                <pre><code class="hljs" data-trim contenteditable>
                    pip install future
                </code></pre>
            </section>
            <section data-transition="fade"></section>
            <section data-transition="fade" data-background-video="assets/outro.mp4">
                <div class="fragment fade-in-then-out">
                    <pre><code class="hljs" data-trim contenteditable style="position: relative; top: -100px; background-color: rgba(0, 0, 0, 0.7);">
                        Step 1: futurize --stage1 -w **/*.py
                    </code></pre>
                    <pre><code class="hljs" data-trim contenteditable style="position: relative; top: -80px; background-color: rgba(0, 0, 0, 0.7);">
                        在不影響 Py2 運行前提下，更新程式至最新語法

                        較沒有造成 bug 的風險

                        加入如 __future__ imports 等

                        可能還不能在 Py3 上跑

                        目的是產生升級中大部分的更動，讓後續加入 Py3 相容性時的改動較少較好追蹤
                    </code></pre>
                </div>
                <div class="fragment fade-in-then-out">
                    <pre><code class="hljs" data-trim contenteditable style="position: relative; top: -100px; background-color: rgba(0, 0, 0, 0.7);">
                        Step 2: futurize --stage2 -w **/*.py
                    </code></pre>
                    <pre><code class="hljs" data-trim contenteditable style="position: relative; top: -80px; background-color: rgba(0, 0, 0, 0.7);">
                        將程式改為 Py3-style code

                        再透過 future 套件加入 Py2 的向後相容

                        執行完 futurize 後，修正直到通過 Py3 CI
                    </code></pre>
                </div>
                <div class="fragment fade-in-then-out">
                    <h5>謝謝收聽</h5>
                </div>
            </section>
        </section>
      </div>
    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.js"></script>

    <script defer="false">
      // Stores all terminal references, added as their slides come into view, by the state name.
      var initializedTerminals = {};

      // More info about config & dependencies:
      // - https://github.com/hakimel/reveal.js#configuration
      // - https://github.com/hakimel/reveal.js#dependencies
      Reveal.initialize({
        // Retain slide info in URL / history.
        history: true,
        dependencies: [
          { src: 'plugin/markdown/marked.js' },
          { src: 'plugin/markdown/markdown.js' },
          { src: 'plugin/notes/notes.js', async: true },
          { src: 'plugin/zoom-js/zoom.js', async: true },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'node_modules/xterm/dist/xterm.js', async: true, callback: function() {
            Terminal.applyAddon(attach);
            Terminal.applyAddon(fit);
            var hostPort = location.hostname + ':' + location.port;
            var terminalsUrl = 'http://' + hostPort + '/terminals';

            var startSlide = Reveal.getCurrentSlide();

            // Find all sections with an embedded terminal, and bind an event listener for when
            // they're clicked into.
            var sectionEls = document.querySelectorAll('section[data-state^="terminal"]');
            sectionEls.forEach(function(section) {
              var stateName = section.getAttribute('data-state');
              var handler = function () {
                if (initializedTerminals[stateName]) {
                  return;
                }
                var terminalEl = section.querySelector('*[data-is-terminal]');
                if (!terminalEl) {
                  console.warn('section ' + stateName + ' had no associated terminal, ignoring');
                  initializedTerminals[stateName] = true;
                  return;
                }
                console.log('initializing terminal for section ' + stateName);
                var pid = 0;
                var cols = terminalEl.getAttribute('data-col');
                var rows = terminalEl.getAttribute('data-row');
                var cur = terminalEl.getAttribute('data-cursor');
                var term = initializedTerminals[stateName] = new Terminal({
                  'macOptionIsMeta': true,
                  // Use a light-colored theme. The default is a black background.
                  'theme': {
                    'background': '#111111',
                    'foreground': '#cccccc',
                    'cursor': cur || '#ffffff',
                    'cursorAccent': '#ffffff',
                    'selection': 'rgba(0, 0, 0, 0.3)',
                  },
                  // These values produce a legible terminal on a slide with a title + one line of
                  // text, without the terminal falling off of the slide.
                  'cols': cols || 70,
                  'rows': rows || 10,
                  'fontSize': 32
                });
                term.on('resize', function (size) {
                  if (!pid) {
                    return;
                  }
                  var cols = size.cols,
                      rows = size.rows,
                      url = terminalsUrl + '/' + pid + '/size?cols=' + cols + '&rows=' + rows;

                  fetch(url, {method: 'POST'});
                });
                term.open(terminalEl);
                term.fit();
                Reveal.layout();

                var cwd = terminalEl.getAttribute('data-cwd');
                var cmd = terminalEl.getAttribute('data-cmd');
                fetch(terminalsUrl + '?cols=' + term.cols + '&rows=' + term.rows +
                        (cwd ? '&cwd=' + cwd : '') + (cmd ? '&cmd=' + cmd : ''),
                    {method: 'POST'}).then(function (res) {
                  res.text().then(function (processId) {
                    console.log('connecting to PID ' + processId);
                    pid = processId;
                    socket = new WebSocket('ws://' + hostPort + '/terminals/' + processId);
                    socket.onopen = function() {
                      term.attach(socket);
                      term._initialized = true;
                      term.fit();
                      Reveal.layout();
                    };
                  });
                });
            };
            if (startSlide === section) {
              handler();
            } else {
              Reveal.addEventListener(stateName, handler, false);
            };
          });
          } }
        ]
      });
    </script>
    <script>
      // LiveReload Updates (hardcoded).
      document.write('<script src="http://' + location.hostname +
        ':35729/livereload.js?snipver=1"></' +
        'script>');
    </script>
  </body>
</html>
